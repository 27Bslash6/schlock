# Safety Rules Configuration
settings:
  cache_size: 1000
  default_risk_level: MEDIUM

whitelist:
  # Core safe commands
  - ^git\s+status
  - ^ls\b
  - ^pwd$

  # Safe directory cleanup operations (common developer workflows)
  - ^rm\s+-rf\s+(node_modules|\.next|dist|build|target|__pycache__|\.pytest_cache|\.venv|venv|coverage|\.cache|\.tox)(/.*)?$
  - ^rm\s+-rf\s+\.git/(hooks|objects/pack|refs)

  # Safe /tmp operations (testing/temporary files)
  - ^chmod\s+[0-7]{3}\s+/tmp/
  - ^chmod\s+-R\s+[0-7]{3}\s+/tmp/

rules:
  # BLOCKED
  - name: fork_bomb
    description: Fork bomb crashes system by spawning infinite processes
    risk_level: BLOCKED
    patterns: [':\(\)\{.{0,200}:\|:&\};:', ':\(\)\s*\{.{0,200}:\s*\|\s*:\s*&\s*\}\s*;?\s*:']
    alternatives: ["NEVER run fork bombs"]

  - name: system_destruction
    description: Complete filesystem destruction
    risk_level: BLOCKED
    patterns: ['rm\s+[^;|&]{0,100}(-rf|-fr|-r\s+-f|-f\s+-r)[^;|&]{0,100}\s+(\/|\/\*|\$HOME|~)(\s|$)', 'rm\s+(\/|\/\*)\s+[^;|&]{0,100}(-rf|-fr|-r\s+-f|-f\s+-r)']
    alternatives: ["Specify exact files instead"]

  - name: credential_exposure
    description: Exposing credentials is a security breach
    risk_level: BLOCKED
    patterns: ['cat\s+.{0,200}\.env', 'cat\s+.{0,200}id_rsa', 'echo.{0,200}password']
    alternatives: ["Use secure secret management"]

  - name: remote_execution
    description: Downloading and executing code is dangerous
    risk_level: BLOCKED
    patterns: ['curl.{0,200}\|\s*bash', 'wget.{0,200}\|\s*sh']
    alternatives: ["Download first, inspect, then run"]

  - name: sudo_use
    description: Requires explicit approval for elevated privileges
    risk_level: BLOCKED
    patterns: ['\bsudo\b']
    alternatives: ["Request admin approval"]

  - name: privilege_escalation_variants
    description: Alternative privilege escalation commands beyond sudo
    risk_level: BLOCKED
    patterns: ['\bsu\b', '\bpkexec\b', '\bdoas\b', '\bgksudo\b', '\bkdesu\b', '\bkdesudo\b', '\bchroot\b.{0,100}(bash|sh|/bin)']
    alternatives: ["Use sudo with proper authentication", "Request admin approval"]

  - name: source_remote_script
    description: Sourcing or executing remote scripts is extremely dangerous
    risk_level: BLOCKED
    patterns: ['source\s+.{0,200}(https?|ftps?|ssh)://', '\.\s+.{0,200}(https?|ftps?|ssh)://', 'bash\s+<\(.{0,100}(curl|wget).{0,100}(https?|ftps?)://', 'sh\s+<\(.{0,100}(curl|wget).{0,100}(https?|ftps?)://', 'source\s+/tmp/.{0,100}\.(sh|bash)', '\.\s+/tmp/.{0,100}\.(sh|bash)']
    alternatives: ["Download first, inspect, then run", "Use package managers"]

  - name: extended_credential_exposure
    description: Accessing additional credential files beyond .env and id_rsa
    risk_level: BLOCKED
    patterns: ['cat\s+.{0,200}\.aws/(credentials|config)', 'cat\s+.{0,200}\.ssh/(config|known_hosts|authorized_keys)', 'cat\s+.{0,200}\.npmrc', 'cat\s+.{0,200}\.netrc', 'cat\s+.{0,200}\.docker/config', 'cat\s+.{0,200}\.kube/config', 'cat\s+.{0,200}\.git-credentials', 'cat\s+.{0,200}\.pypirc', 'echo.{0,200}(AWS_SECRET|API_KEY|TOKEN|PASSWORD|PRIVATE_KEY)', 'printf.{0,200}(AWS_SECRET|API_KEY|TOKEN|PASSWORD|PRIVATE_KEY)']
    alternatives: ["Use proper secret management tools", "Never expose credentials"]

  - name: disk_device_manipulation
    description: Additional disk device destruction patterns
    risk_level: BLOCKED
    patterns: ['cat.{0,100}>\s*/dev/(sd[a-z]|hd[a-z]|nvme|loop|md|vd[a-z])', 'echo.{0,100}>\s*/dev/(sd[a-z]|hd[a-z]|nvme|loop|md|vd[a-z])', 'cp.{0,100}/dev/(sd[a-z]|hd[a-z]|nvme|loop|md)', 'mv.{0,100}/dev/(sd[a-z]|hd[a-z]|nvme|loop|md)', 'truncate.{0,100}/dev/(sd[a-z]|hd[a-z]|nvme)', 'hdparm.{0,100}--user-master.{0,100}--security-erase', 'blkdiscard.{0,100}/dev/', 'fstrim.{0,100}--all']
    alternatives: ["Never write directly to disk devices", "Use disk management tools with extreme caution"]

  - name: protect_system_files
    description: Prevent modifications to system files
    risk_level: BLOCKED
    patterns: ['\b(rm|mv|cp)\s+.{0,200}/(etc|sys|proc|boot|sbin|dev)/', '>\s*/(etc|sys|proc|boot|sbin)/', 'rm\s+/sbin/init', 'rm\s+/dev/', 'chmod.{0,100}/(sbin|dev|usr/lib/systemd)/', 'chmod\s+000\s+/usr/', 'mknod\s+/dev/']
    alternatives: ["Use configuration management tools", "Request system administrator access"]

  - name: hardcoded_secrets
    description: Prevent hardcoding secrets
    risk_level: BLOCKED
    patterns: ['export\s+AWS_SECRET', 'export\s+.{0,100}_KEY=', 'export\s+.{0,100}_TOKEN=', "echo.{0,200}['\"].{0,100}key.{0,100}['\"]\\s*>"]
    alternatives: ["Use environment files", "Use secrets manager", "Use vault"]

  - name: disk_destruction_dd
    description: Prevent disk overwriting with dd
    risk_level: BLOCKED
    patterns: ['dd\s+.{0,200}of=/dev/[sh]d[a-z]', 'dd\s+.{0,200}of=/dev/nvme', 'dd\s+.{0,200}of=/dev/loop', 'dd\s+.{0,200}of=/boot', '>\s*/dev/[sh]d[a-z]', '>\s*/dev/nvme', '>\s*/boot/']
    alternatives: ["Never write directly to disk devices", "Use disk management tools carefully", "Create backups first"]

  - name: filesystem_format
    description: Prevent filesystem formatting
    risk_level: BLOCKED
    patterns: ['mkfs\b', 'mkfs\.[a-z]+\s+/dev/', 'mke2fs\b', 'mkswap\b', 'mkfs\.ext[234]\b', 'mkfs\.xfs\b', 'mkfs\.btrfs\b']
    alternatives: ["Format only specific partitions after backup", "Use disk management GUI tools", "Verify device path carefully"]

  - name: partition_manipulation
    description: Prevent partition table changes
    risk_level: BLOCKED
    patterns: ['fdisk\s+/dev/', 'parted\s+.{0,100}\s+/dev/', 'parted\s+/dev/', 'gparted\b', 'sfdisk\b', 'gdisk\b', 'cfdisk\b']
    alternatives: ["Use disk management tools with extreme caution", "Create full disk backup first", "Verify device paths"]

  - name: filesystem_wipe
    description: Prevent filesystem signature wiping
    risk_level: BLOCKED
    patterns: ['wipefs\b', 'blkdiscard\b', 'shred\s+.{0,100}\s+/dev/', 'shred\s+/dev/']
    alternatives: ["Never wipe filesystem signatures", "Use secure erase only on specific files", "Verify target carefully"]

  # HIGH
  - name: recursive_delete
    description: Recursive delete can destroy directory trees
    risk_level: HIGH
    patterns: ['rm\s+-r', 'find.{0,200}-delete']
    alternatives: ["Use rm -ri for interactive"]

  - name: git_force_push
    description: Force push overwrites remote history
    risk_level: HIGH
    patterns: ['git\s+push[^;|&]{0,100}--force(?!-with-lease)', 'git\s+push[^;|&]{0,100}\s-f(\s|$)']
    alternatives: ["Use --force-with-lease"]

  - name: git_hard_reset
    description: Hard reset destroys uncommitted work
    risk_level: HIGH
    patterns: ['git\s+reset\s+--hard']
    alternatives: ["Use git stash first"]

  - name: database_drop
    description: Dropping databases is irreversible
    risk_level: HIGH
    patterns: ['DROP\s+DATABASE', 'DROP\s+TABLE']
    alternatives: ["Backup first"]

  - name: chmod_777
    description: Creates security vulnerability
    risk_level: HIGH
    patterns: ['chmod\s+777', 'chmod\s+-R\s+777', 'chmod\s+777.*-R', 'chmod\s+--recursive\s+777']
    alternatives: ["Use 755 or 644"]

  - name: docker_privileged
    description: Privileged containers can escape
    risk_level: HIGH
    patterns: ['docker.{0,200}--privileged']
    alternatives: ["Use proper security boundaries"]

  - name: npm_global
    description: Global installs pollute system
    risk_level: HIGH
    patterns: ['npm\s+install\s+-g']
    alternatives: ["Use local dependencies"]

  - name: pip_system
    description: System Python installs break tools
    risk_level: HIGH
    patterns: ['pip\s+install\s+(?![^;|&]{0,100}--user)']
    alternatives: ["Use venv"]

  - name: eval_exec
    description: Executes arbitrary code - can run anything
    risk_level: BLOCKED
    patterns: ['^\s*eval\s+', '\|\s*eval\s+', ';\s*eval\s+', '&&\s*eval\s+', '^\s*exec\s+', '\|\s*exec\s+', ';\s*exec\s+', '&&\s*exec\s+']
    alternatives: ["Parse and validate input", "Avoid dynamic code execution"]

  - name: find_exec_dangerous
    description: Find with dangerous exec commands
    risk_level: HIGH
    patterns: ['find.{0,200}-exec\s+(rm|sh|bash|python|perl|ruby|node|curl|wget|dd|mkfs|fdisk|mount)', 'find.{0,200}-exec.{0,100}\|.{0,50}bash', 'find.{0,200}-exec.{0,100}\|.{0,50}sh']
    alternatives: ["Review what will be executed", "Use xargs instead", "Test on small subset first"]

  - name: command_substitution_dangerous
    description: Command substitution with dangerous commands executes code
    risk_level: BLOCKED
    patterns: ['\$\([^)]{0,200}\b(rm|sudo|dd|mkfs|chmod|eval|exec)', '`[^`]{0,200}\b(rm|sudo|dd|mkfs|chmod|eval|exec)']
    alternatives: ["Avoid dynamic command execution", "Use explicit commands instead", "Run commands directly without substitution"]

  - name: find_exec_rm
    description: Can delete many files
    risk_level: HIGH
    patterns: ['find.{0,200}-exec\s+rm']
    alternatives: ["Review results first"]

  - name: aws_resource_deletion
    description: Prevent accidental AWS resource deletion
    risk_level: HIGH
    patterns: ['aws\s+.{0,100}\s+delete', 'aws\s+.{0,100}\s+terminate', 'terraform\s+destroy']
    alternatives: ["Use AWS console with MFA", "Create snapshot/backup first"]

  - name: open_network_ports
    description: Prevent opening dangerous network ports
    risk_level: HIGH
    patterns: ['iptables.{0,200}ACCEPT', 'ufw\s+allow', 'firewall-cmd.{0,100}--add-port']
    alternatives: ["Use security groups", "Implement proper ACLs"]

  - name: interpreter_dangerous_execution
    description: Scripting language arbitrary code execution with dangerous functions
    risk_level: HIGH
    patterns: ["python[23]?\\s+-c\\s+[\"']?.{0,200}(os\\.system|subprocess\\.(call|run|Popen)|exec|eval|compile|__import__)", "perl\\s+-[eE]\\s+[\"']?.{0,200}(system|exec|eval|`|qx)", "ruby\\s+-e\\s+[\"']?.{0,200}(system|exec|eval|%x|`)", "node\\s+-e\\s+[\"']?.{0,200}(exec|eval|require.{0,30}child_process)", "php\\s+-r\\s+[\"']?.{0,200}(system|exec|eval|shell_exec|passthru|`)", "awk.{0,200}BEGIN\\s*\\{.{0,100}(system|getline.{0,30}\\|)", "sed\\s+.{0,100}e\\s+[\"']?.{0,100}(sh|bash|rm|chmod)"]
    alternatives: ["Avoid dynamic code execution", "Use proper scripts instead of one-liners"]

  - name: xargs_dangerous_commands
    description: xargs with destructive commands can affect many files
    risk_level: HIGH
    patterns: ['xargs\s+.{0,100}(rm|sudo|chmod|chown|dd|mkfs|shred)', 'xargs\s+.{0,100}-I.{1,10}\s+(rm|sudo|chmod|chown|dd|mkfs)', 'parallel\s+.{0,100}(rm|sudo|chmod|chown|dd|mkfs)', 'find.{0,200}\|\s*xargs\s+(rm|chmod|chown)']
    alternatives: ["Review input before piping to xargs", "Use -p flag for confirmation", "Test with echo first"]

  - name: alternate_shells_and_escapes
    description: Alternative shell invocations and escape sequences
    risk_level: HIGH
    patterns: ["sh\\s+-c\\s+[\"']?.{0,200}(rm|dd|mkfs|chmod|sudo)", "bash\\s+-c\\s+[\"']?.{0,200}(rm|dd|mkfs|chmod|sudo)", "zsh\\s+-c\\s+[\"']?.{0,200}(rm|dd|mkfs|chmod|sudo)", 'env\s+.{0,100}(bash|sh|zsh)\s+-c', 'nohup\s+.{0,100}(rm|dd|mkfs|chmod)', 'screen\s+-dm\s+.{0,100}(bash|sh)', 'tmux\s+.{0,100}send-keys.{0,100}(rm|dd|mkfs)']
    alternatives: ["Run commands directly", "Avoid shell invocation", "Use proper job control"]

  - name: macos_script_execution
    description: macOS-specific script execution and system control
    risk_level: HIGH
    patterns: ['osascript\s+(-e|-).*', 'osascript\s+.{0,200}\.(scpt|applescript)', 'open\s+-a\s+Terminal', 'open\s+-a\s+.{0,100}--args', 'automator\s+', 'shortcuts\s+run']
    alternatives: ["Avoid scripting system automation", "Use explicit commands instead", "Review script contents first"]

  - name: macos_system_modification
    description: macOS system configuration and security modifications
    risk_level: HIGH
    patterns: ['launchctl\s+(load|unload|bootout|disable)', 'defaults\s+write\s+.{0,200}(com\.apple|NSGlobalDomain)', 'defaults\s+delete', 'dscl\s+.{0,100}(create|delete|passwd)', 'security\s+(delete-keychain|unlock-keychain|set-keychain-settings)', 'spctl\s+--master-disable', 'csrutil\s+disable', 'nvram\s+']
    alternatives: ["Use System Preferences", "Document system changes", "Require admin approval"]

  - name: windows_script_execution
    description: Windows-specific script execution vectors
    risk_level: HIGH
    patterns: ['powershell\s+(-c|-Command|-EncodedCommand|-e)', 'pwsh\s+(-c|-Command)', 'cmd\s+/c', 'cmd\.exe\s+/c', 'wscript\s+', 'cscript\s+', 'mshta\s+', 'rundll32\s+', 'regsvr32\s+/s', 'certutil\s+.{0,100}(-decode|-urlcache)']
    alternatives: ["Use explicit commands", "Avoid encoded commands", "Review script contents"]

  - name: linux_dbus_execution
    description: Linux D-Bus and desktop automation
    risk_level: MEDIUM
    patterns: ['dbus-send\s+.{0,200}(Exec|Launch|Run)', 'gdbus\s+call\s+', 'qdbus\s+.{0,100}(exec|run)', 'xdotool\s+', 'xte\s+', 'expect\s+-c']
    alternatives: ["Use direct commands", "Avoid automation scripts", "Review automation carefully"]

  - name: data_exfiltration
    description: Data exfiltration patterns
    risk_level: HIGH
    patterns: ['curl\s+.{0,100}(-F|--form).{0,100}@', 'curl\s+.{0,100}(--upload-file|-T)', 'wget\s+.{0,100}--post-file', 'tar\s+.{0,100}\|\s*.{0,50}(nc|ncat|socat|ssh)', 'base64\s+.{0,100}\|\s*.{0,50}curl', 'openssl\s+enc.{0,100}\|\s*.{0,50}(nc|curl)', 'zip\s+-P.{0,100}\|\s*.{0,50}curl', 'scp\s+.{0,200}@.{0,100}:', 'rsync\s+.{0,200}@.{0,100}:']
    alternatives: ["Use secure file transfer", "Verify destination", "Use encryption"]

  - name: permission_manipulation_extended
    description: Additional permission and attribute manipulation commands
    risk_level: HIGH
    patterns: ['setfacl\s+.{0,100}-m\s+.{0,100}:rwx', 'setfacl\s+.{0,100}--modify', 'chattr\s+.{0,100}[-+]i', 'chattr\s+.{0,100}[-+]a', 'umask\s+0{1,3}[0-7]?', 'chmod\s+.{0,100}\+s', 'chmod\s+[24]7[0-7]{2}', 'chmod\s+.{0,100}a\+[rwx]+']
    alternatives: ["Use restrictive permissions", "Document permission changes", "Use configuration management"]

  - name: system_service_modification
    description: System configuration and startup modification
    risk_level: HIGH
    patterns: ['systemctl\s+.{0,100}(disable|mask|stop).{0,100}(firewall|apparmor|selinux|ufw|iptables)', 'update-rc\.d\s+.{0,100}(disable|remove)', 'chkconfig\s+.{0,100}off', 'crontab\s+-r', 'at\s+.{0,100}(midnight|now)', 'echo.{0,200}>>\s*/etc/cron', 'modprobe\s+.{0,100}(ip_tables|nf_|xt_)', 'insmod\s+.{0,100}\.ko', 'sysctl\s+-w\s+.{0,100}=0']
    alternatives: ["Use configuration management", "Document system changes", "Test in isolation"]

  - name: file_truncation
    description: File truncation can instantly destroy data
    risk_level: HIGH
    patterns: ["^\\s*>\\s+(?!/dev/null)[^|&;]{1,200}", ":\\s*>\\s+(?!/dev/null)[^|&;]{1,200}", "true\\s+>\\s+(?!/dev/null)[^|&;]{1,200}", "truncate\\s+.{0,100}(-s|--size)\\s*0", "echo\\s+-n\\s+>\\s+(?!/dev/null)[^|&;]{1,200}", "printf\\s+[\"']\\s*[\"']?\\s*>\\s+(?!/dev/null)[^|&;]{1,200}", "tee\\s+(?!.{0,50}-a)(?!/dev/null)[^|&;]{1,200}"]
    alternatives: ["Use proper log rotation", "Backup before truncating", "Use >> for append"]

  - name: network_service_exposure
    description: Exposing network services can create security holes
    risk_level: HIGH
    patterns: ['python[23]?\s+-m\s+(http\.server|SimpleHTTPServer)', 'php\s+-S\s+[0-9.:\[\]]{1,50}', 'ruby\s+-run\s+-e\s+httpd', 'busybox\s+httpd', 'nc\s+.{0,100}-l.{0,100}-p?\s*[0-9]{1,5}', 'ncat\s+.{0,100}--listen', 'socat\s+.{0,100}TCP-LISTEN:', 'ssh\s+.{0,100}-[RLD]\s*[0-9]{1,5}:']
    alternatives: ["Use proper web servers with authentication", "Limit to localhost", "Use firewalls"]

  - name: container_escape
    description: Container escape and privilege escalation vectors
    risk_level: HIGH
    patterns: ['docker.{0,200}-v\s+/:/[a-z/]+', 'docker.{0,200}--volume\s+/:/[a-z/]+', 'docker.{0,200}--cap-add.{0,50}(SYS_ADMIN|ALL)', 'docker.{0,200}--security-opt.{0,50}(apparmor=unconfined|seccomp=unconfined|privileged)', 'docker.{0,200}--pid.{0,20}host', 'docker.{0,200}--network.{0,20}host.{0,100}--privileged', 'kubectl\s+exec.{0,200}--privileged', 'kubectl\s+run.{0,200}--privileged', 'nsenter\s+.{0,100}--target\s+1', 'podman.{0,200}--privileged']
    alternatives: ["Use proper container security", "Avoid privileged containers", "Use security policies"]

  - name: log_tampering
    description: System log manipulation hides malicious activity
    risk_level: HIGH
    patterns: ['>\s*/var/log/[^|&;]{1,200}', 'rm\s+.{0,100}/var/log/[^|&;]{1,200}', 'truncate\s+.{0,100}/var/log/', 'echo\s+.{0,100}>\s*/var/log/', 'shred\s+.{0,100}/var/log/', 'history\s+-c', 'unset\s+HISTFILE', 'export\s+HISTSIZE=0', 'ln\s+-sf\s+/dev/null\s+.{0,100}\.bash_history']
    alternatives: ["Use log rotation tools", "Preserve audit trails", "Use centralized logging"]

  - name: recursive_permission_system_dirs
    description: Recursive permission changes on system directories destroy systems
    risk_level: BLOCKED
    patterns: ['chmod\s+(-R|--recursive)\s+[0-7]{3}\s+(\/|\/etc|\/home|\/usr|\/var|\/opt|\/srv)(\s|$)', 'chmod\s+[0-7]{3}\s+(-R|--recursive)\s+(\/|\/etc|\/home|\/usr|\/var|\/opt|\/srv)(\s|$)', 'chown\s+(-R|--recursive)\s+.{0,100}\s+(\/|\/etc|\/home|\/usr|\/var|\/opt|\/srv)(\s|$)', 'chown\s+.{0,100}\s+(-R|--recursive)\s+(\/|\/etc|\/home|\/usr|\/var|\/opt|\/srv)(\s|$)', 'find\s+/(|etc|home|usr|var)\s+.{0,200}-exec\s+(chmod|chown)']
    alternatives: ["NEVER change permissions recursively on system directories", "Target specific files only", "Use configuration management"]

  - name: recursive_permission_destruction
    description: Recursive permission changes can break systems
    risk_level: HIGH
    patterns: ['chmod\s+-R\s+[0-7]{3}', 'chmod\s+--recursive', 'chmod\s+[0-7]{3}.{0,50}-R', 'chown\s+-R', 'chown\s+--recursive', 'find\s+/.{0,200}-exec\s+(chmod|chown).{0,50}\{\}']
    alternatives: ["Target specific directories only", "Use configuration management", "Test in isolated environment"]

  - name: network_backdoor
    description: Prevent network backdoor creation via netcat/socat
    risk_level: BLOCKED
    patterns: ['nc\s+[^;|&]{0,100}-e\s+', 'ncat\s+[^;|&]{0,100}--exec', 'socat[^;|&]{0,100}EXEC:', 'netcat\s+[^;|&]{0,100}-e']
    alternatives: ["Use proper remote access tools", "Set up SSH with key authentication", "Use VPN for remote access"]

  - name: system_critical_writes
    description: Prevent writes to critical system locations
    risk_level: HIGH
    patterns: ['(?<!2)>\s*/proc/sys/', '(?<!2)>\s*/boot/', 'echo.{0,200}(?<!2)>\s*/dev/(?!null\b)', 'cat.{0,200}(?<!2)>\s*/dev/(?!null\b)']
    alternatives: ["Never write directly to system files", "Use proper system APIs", "Modify via configuration files"]

  # MEDIUM
  - name: single_delete
    description: Deleting files without backup
    risk_level: MEDIUM
    patterns: ['^rm\s+[^-]']
    alternatives: ["Backup first"]

  - name: git_push
    description: Pushing to remote
    risk_level: MEDIUM
    patterns: ['^git\s+push\b']
    alternatives: ["Review with git log"]

  - name: git_merge
    description: Can create conflicts
    risk_level: MEDIUM
    patterns: ['git\s+merge']
    alternatives: ["Clean working directory"]

  - name: git_rebase
    description: Rewrites history
    risk_level: MEDIUM
    patterns: ['git\s+rebase']
    alternatives: ["Only rebase local commits"]

  - name: chmod_exec
    description: Making files executable
    risk_level: MEDIUM
    patterns: ['chmod\s+\+x']
    alternatives: ["Ensure file is trusted"]

  - name: resource_intensive_operations
    description: Warn about resource-intensive operations
    risk_level: MEDIUM
    patterns: ['find\s+/\s+', 'grep\s+-r\s+.{0,100}\s+/', 'du\s+-h\s+/']
    alternatives: ["Limit search scope", "Use more specific paths"]

  - name: package_installation_system
    description: System-wide package installation
    risk_level: MEDIUM
    patterns: ['apt\s+install(?!\s+.{0,50}--dry-run)', 'apt-get\s+install(?!\s+.{0,50}--dry-run)', 'yum\s+install', 'dnf\s+install', 'zypper\s+(install|in)', 'pacman\s+-S', 'snap\s+install', 'flatpak\s+install']
    alternatives: ["Use containerized environments", "Document dependencies", "Use virtual environments"]

  - name: compiler_and_binary_execution
    description: Compiling and executing arbitrary binaries
    risk_level: MEDIUM
    patterns: ['gcc\s+.{0,100}\.c\s+.{0,50}&&\s*\./', 'g\+\+\s+.{0,100}\.cpp\s+.{0,50}&&\s*\./', 'javac\s+.{0,100}\.java\s+.{0,50}&&\s*java', 'go\s+run\s+', 'rustc\s+.{0,100}\.rs\s+.{0,50}&&\s*\./', 'make\s+&&\s*\./', 'cmake\s+.{0,100}&&\s*make\s+&&']
    alternatives: ["Review source code first", "Use sandboxed environments", "Scan for malware"]

  - name: archive_operations
    description: Archive operations that could extract malicious files
    risk_level: MEDIUM
    patterns: ['tar\s+.{0,100}(-x|--extract).{0,100}/', 'unzip\s+.{0,100}-o', 'gunzip\s+.{0,100}-f', '7z\s+x\s+.{0,100}-y', 'rar\s+x\s+.{0,100}-o\+']
    alternatives: ["Extract to safe directory", "Review archive contents first", "Use sandboxed extraction"]

  - name: process_manipulation
    description: Process and signal manipulation
    risk_level: MEDIUM
    patterns: ['kill\s+-9\s+1(?!\d)', 'killall\s+.{0,100}(systemd|init|kernel)', 'pkill\s+.{0,100}(systemd|init|kernel)', 'nice\s+-n\s+-20', 'renice\s+.{0,100}-20']
    alternatives: ["Target specific processes", "Use proper process management", "Avoid system processes"]

  - name: mount_operations
    description: Filesystem mounting with dangerous options
    risk_level: MEDIUM
    patterns: ['mount\s+.{0,100}-o\s+.{0,100}(rw|exec|suid)', 'mount\s+.{0,100}--bind\s+/\s+', 'mount\s+.{0,100}-t\s+.{0,100}/dev/', 'umount\s+-f', 'umount\s+/']
    alternatives: ["Use proper mount points", "Document mount operations", "Use read-only where possible"]

  - name: user_management
    description: User and group modifications
    risk_level: MEDIUM
    patterns: ['useradd\s+.{0,100}-G\s+.{0,100}(sudo|wheel|admin)', 'usermod\s+.{0,100}-a\s+-G\s+.{0,100}(sudo|wheel|admin)', 'passwd\s+-d', 'passwd\s+root', 'visudo', 'echo.{0,200}>>\s*/etc/sudoers', 'adduser\s+.{0,100}--disabled-password']
    alternatives: ["Use proper user management", "Document user changes", "Use LDAP/SSO"]

  # LOW
  - name: git_commit
    description: Committing changes
    risk_level: LOW
    patterns: ['^git\s+commit']
    alternatives: []

  - name: npm_install
    description: Installing npm packages
    risk_level: LOW
    patterns: ['^npm\s+install']
    alternatives: []

  - name: pip_requirements
    description: Installing Python requirements
    risk_level: LOW
    patterns: ['pip.{0,50}-r\s+requirements']
    alternatives: []

  - name: yarn_install
    description: Installing yarn dependencies
    risk_level: LOW
    patterns: ['^yarn\s+install']
    alternatives: []

  - name: cargo_build
    description: Building Rust project
    risk_level: LOW
    patterns: ['^cargo\s+build']
    alternatives: []

  - name: make_build
    description: Running make
    risk_level: LOW
    patterns: ['^make\b']
    alternatives: []

  - name: docker_build
    description: Building Docker image
    risk_level: LOW
    patterns: ['^docker\s+build']
    alternatives: []

  - name: docker_run
    description: Running container
    risk_level: LOW
    patterns: ['^docker\s+run\s+(?!.{0,200}--privileged)']
    alternatives: []

  - name: curl_download
    description: Downloading with curl
    risk_level: LOW
    patterns: ['^curl\s+-[OL]']
    alternatives: []

  - name: wget_download
    description: Downloading with wget
    risk_level: LOW
    patterns: ['^wget\s+https']
    alternatives: []

  # SAFE
  - name: git_log
    description: Viewing git log
    risk_level: SAFE
    patterns: ['^git\s+log']
    alternatives: []

  - name: list_files
    description: Listing files
    risk_level: SAFE
    patterns: ['^ls\b']
    alternatives: []

  - name: pwd_cmd
    description: Print working directory
    risk_level: SAFE
    patterns: ['^pwd$']
    alternatives: []

  - name: simple_echo
    description: Echo simple text
    risk_level: SAFE
    patterns: ['^echo\s+[\w\s]+$']
    alternatives: []

  - name: cat_read
    description: Reading file contents
    risk_level: SAFE
    patterns: ['^cat\s+[\w/]+\.txt$']
    alternatives: []
