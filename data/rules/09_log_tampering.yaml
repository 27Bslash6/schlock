# Category: Log Tampering
# Risk Levels: BLOCKED, HIGH
# Description: Commands that manipulate system logs and audit trails

rules:
  - name: log_tampering
    description: System log manipulation hides malicious activity
    risk_level: HIGH
    patterns: ['>\s*/var/log/[^|&;]{1,200}', '\brm\s+.{0,100}/var/log/[^|&;]{1,200}', '\btruncate\s+.{0,100}/var/log/', '\becho\s+.{0,100}>\s*/var/log/', '\bshred\s+.{0,100}/var/log/', '\bhistory\s+-c', '\bunset\s+HISTFILE', '\bexport\s+HISTSIZE=0', '\bln\s+-sf\s+/dev/null\s+.{0,100}\.bash_history']
    alternatives: ["Use log rotation tools", "Preserve audit trails", "Use centralized logging"]

  # ============================================================
  # GAP-001: Extended History Manipulation
  # ============================================================

  - name: history_evasion_extended
    description: Advanced history manipulation to hide malicious commands
    risk_level: BLOCKED
    patterns:
      # HISTFILE redirection to /dev/null
      - '\bHISTFILE\s*=\s*/dev/null'
      - '\bHISTFILE\s*=\s*[''"]?/dev/null'
      - '\bexport\s+HISTFILE\s*=\s*/dev/null'
      # HISTFILESIZE manipulation
      - '\bHISTFILESIZE\s*=\s*0'
      - '\bexport\s+HISTFILESIZE\s*=\s*0'
      # Direct history file truncation
      - '>\s*~/?\.(bash_history|zsh_history|zsh-history)'
      - '\bcat\s+/dev/null\s*>\s*~/?\.(bash_history|zsh_history)'
      # Other shell histories
      - '>\s*~/?\.(zsh_history|fish_history|ash_history)'
      - '\brm\s+[^;|&]*\.(bash_history|zsh_history|fish_history)'
      # Shell option manipulation
      - '\bset\s+\+o\s+history'
      - '\bshopt\s+-u\s+histappend'
    alternatives:
      - "History manipulation indicates malicious intent"
      - "Audit trails should be preserved"
