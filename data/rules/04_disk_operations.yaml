# Category: Disk Operations
# Risk Levels: BLOCKED
# Description: Commands that directly manipulate disk devices and filesystems

rules:
  - name: disk_destruction_dd
    description: Prevent disk overwriting with dd
    risk_level: BLOCKED
    patterns: ['\bdd\s+.{0,200}of=/dev/[sh]d[a-z]', '\bdd\s+.{0,200}of=/dev/nvme', '\bdd\s+.{0,200}of=/dev/loop', '\bdd\s+.{0,200}of=/boot', '>\s*/dev/[sh]d[a-z]', '>\s*/dev/nvme', '>\s*/boot/']
    alternatives: ["Never write directly to disk devices", "Use disk management tools carefully", "Create backups first"]

  - name: disk_device_manipulation
    description: Additional disk device destruction patterns
    risk_level: BLOCKED
    patterns: ['\bcat.{0,100}>\s*/dev/(sd[a-z]|hd[a-z]|nvme|loop|md|vd[a-z])', '\becho.{0,100}>\s*/dev/(sd[a-z]|hd[a-z]|nvme|loop|md|vd[a-z])', '\bcp.{0,100}/dev/(sd[a-z]|hd[a-z]|nvme|loop|md)', '\bmv.{0,100}/dev/(sd[a-z]|hd[a-z]|nvme|loop|md)', '\btruncate.{0,100}/dev/(sd[a-z]|hd[a-z]|nvme)', '\bhdparm.{0,100}--user-master.{0,100}--security-erase', '\bblkdiscard.{0,100}/dev/', '\bfstrim.{0,100}--all']
    alternatives: ["Never write directly to disk devices", "Use disk management tools with extreme caution"]

  - name: filesystem_format
    description: Prevent filesystem formatting
    risk_level: BLOCKED
    patterns: ['\bmkfs\b', '\bmkfs\.[a-z]+\s+/dev/', '\bmke2fs\b', '\bmkswap\b', '\bmkfs\.ext[234]\b', '\bmkfs\.xfs\b', '\bmkfs\.btrfs\b']
    alternatives: ["Format only specific partitions after backup", "Use disk management GUI tools", "Verify device path carefully"]

  - name: partition_manipulation
    description: Prevent partition table changes
    risk_level: BLOCKED
    patterns: ['\bfdisk\s+/dev/', '\bparted\s+.{0,100}\s+/dev/', '\bparted\s+/dev/', '\bgparted\b', '\bsfdisk\b', '\bgdisk\b', '\bcfdisk\b']
    alternatives: ["Use disk management tools with extreme caution", "Create full disk backup first", "Verify device paths"]

  - name: filesystem_wipe
    description: Prevent filesystem signature wiping
    risk_level: BLOCKED
    patterns: ['\bwipefs\b', '\bblkdiscard\b', '\bshred\s+.{0,100}\s+/dev/', '\bshred\s+/dev/']
    alternatives: ["Never wipe filesystem signatures", "Use secure erase only on specific files", "Verify target carefully"]
